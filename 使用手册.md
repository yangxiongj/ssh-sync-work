# Gitæ–‡ä»¶åŒæ­¥ç³»ç»Ÿ - ä½¿ç”¨æ‰‹å†Œ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 0. WSLç¯å¢ƒå‡†å¤‡ï¼ˆå¦‚æœä½¿ç”¨WSLï¼‰

#### å¯ç”¨WSL systemdæ”¯æŒ
```bash
# ç¼–è¾‘WSLé…ç½®æ–‡ä»¶
sudo nano /etc/wsl.conf

# æ·»åŠ ä»¥ä¸‹å†…å®¹
[boot]
systemd=true
```

ç„¶ååœ¨Windows PowerShellä¸­é‡å¯WSLï¼š
```powershell
wsl --shutdown
```

#### å®‰è£…å¿…è¦ä¾èµ–
```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£…ä¾èµ–
sudo apt install git rsync openssh-client tar
```

#### é…ç½®SSHå¯†é’¥è®¤è¯
```bash
# ç”ŸæˆSSHå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
ssh-keygen -t rsa -b 4096

# å°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨
ssh-copy-id user@your-server-ip
```

#### Windowsè·¯å¾„æ˜ å°„
- `C:\Users\` â†’ `/mnt/c/Users/`
- `D:\PycharmProjects\` â†’ `/mnt/d/PycharmProjects/`
- `E:\Data\` â†’ `/mnt/e/Data/`

### 1. å®‰è£…ç³»ç»Ÿ
```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®æ–‡ä»¶
chmod +x *.sh

# ä¸€é”®å®‰è£…ï¼ˆæ¨èï¼Œä¼šè‡ªåŠ¨ä¸Šä¼ è¿œç¨‹è„šæœ¬ï¼‰
sudo ./install.sh

# æ‰‹åŠ¨å®‰è£…
sudo ./sync-service.sh install
./sync-service.sh start
```

**æ³¨æ„**: å®‰è£…è¿‡ç¨‹ä¼šè‡ªåŠ¨ä¸Šä¼ `remote-sync-helper.sh`åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç¡®ä¿SSHè¿æ¥å·²é…ç½®ã€‚

### 2. åŸºæœ¬é…ç½®
ç¼–è¾‘é…ç½®æ–‡ä»¶ `/mnt/d/sync.yaml`:
```yaml
remote:
  host: "your-server-ip"
  port: 22
  dir: "/path/to/remote/work"

directories:
  - /path/to/local/project1
  - /path/to/local/project2

refresh_interval: 60
```

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./sync-service.sh status

# å¯åŠ¨æœåŠ¡
./sync-service.sh start

# åœæ­¢æœåŠ¡
./sync-service.sh stop

# é‡å¯æœåŠ¡
./sync-service.sh restart

# æŸ¥çœ‹æ—¥å¿—
./sync-service.sh logs

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
./sync-service.sh logs-f

# å¸è½½æœåŠ¡
sudo ./sync-service.sh uninstall
```

### ç›´æ¥è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰
```bash
# ç›´æ¥è¿è¡ŒåŒæ­¥è„šæœ¬
./sync-files.sh

# åå°è¿è¡Œ
nohup ./sync-files.sh > sync.log 2>&1 &
```

## ğŸ”§ é…ç½®å‚æ•°è¯¦è§£

### å®Œæ•´é…ç½®ç¤ºä¾‹
```yaml
# è¿œç¨‹æœåŠ¡å™¨é…ç½®
remote:
  host: "34.68.158.244"        # å¿…éœ€ï¼šè¿œç¨‹æœåŠ¡å™¨IP/åŸŸå
  port: 22                     # å¯é€‰ï¼šSSHç«¯å£ï¼Œé»˜è®¤22
  dir: "/root/work"            # å¿…éœ€ï¼šè¿œç¨‹å·¥ä½œç›®å½•

# æœ¬åœ°ç›‘æ§ç›®å½•
directories:
  - /mnt/d/PycharmProjects/test

# åŒæ­¥é—´éš”ï¼ˆç§’ï¼‰
refresh_interval: 60           # å¯é€‰ï¼šé»˜è®¤60ç§’

# æ’é™¤æ¨¡å¼ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰
exclude_patterns:
  - '.git'                     # Gitç›®å½•
  - '.idea'                    # IDEé…ç½®
  - '.vscode'                  # VS Codeé…ç½®
  - '__pycache__'              # Pythonç¼“å­˜
  - 'node_modules'             # Node.jsä¾èµ–
  - '*.log'                    # æ—¥å¿—æ–‡ä»¶
  - '*.tmp'                    # ä¸´æ—¶æ–‡ä»¶
  - 'build'                    # æ„å»ºç›®å½•
  - 'target'                   # æ„å»ºç›®å½•
  - '.env'                     # ç¯å¢ƒå˜é‡æ–‡ä»¶
```

### é»˜è®¤é…ç½®å€¼
```bash
DEFAULT_REMOTE_HOST="34.68.158.244"
DEFAULT_REMOTE_PORT="22"
DEFAULT_REMOTE_DIR="/root/work"
DEFAULT_REFRESH_INTERVAL=60
DEFAULT_LOCAL_DIRS=
```

## ğŸ“Š çŠ¶æ€ä¿¡æ¯è§£è¯»

### æ–‡ä»¶çŠ¶æ€æ ‡è¯†
- **M:n** - Modified: nä¸ªä¿®æ”¹çš„æ–‡ä»¶
- **S:n** - Staged: nä¸ªæš‚å­˜çš„æ–‡ä»¶
- **U:n** - Untracked: nä¸ªæœªè·Ÿè¸ªçš„æ–‡ä»¶
- **P:n** - Unpushed: nä¸ªæœªæ¨é€çš„æ–‡ä»¶

### åŒæ­¥çŠ¶æ€æ¶ˆæ¯
- `Initial sync...` - æ‰§è¡Œåˆå§‹å®Œæ•´åŒæ­¥
- `Syncing n files (M:x S:y U:z P:w)` - åŒæ­¥nä¸ªæ–‡ä»¶ï¼ŒåŒ…å«å„ç§çŠ¶æ€
- `Files synced` - æ–‡ä»¶åŒæ­¥æˆåŠŸ
- `No changes to sync` - æ— å˜æ›´éœ€è¦åŒæ­¥
- `No local changes, updating remote...` - æ— æœ¬åœ°å˜æ›´ï¼Œæ›´æ–°è¿œç¨‹ç‰ˆæœ¬
- `Updated to local version` - è¿œç¨‹å·²æ›´æ–°åˆ°æœ¬åœ°ç‰ˆæœ¬
- `Remote version is newer` - è¿œç¨‹ç‰ˆæœ¬æ›´æ–°
- `Sync failed` - åŒæ­¥å¤±è´¥

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. SSHè¿æ¥å¤±è´¥
```bash
# é—®é¢˜ï¼šè¿æ¥è¢«æ‹’ç»
Connection refused

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥æœåŠ¡å™¨IPå’Œç«¯å£
ping your-server-ip
telnet your-server-ip 22

# 2. æ£€æŸ¥SSHå¯†é’¥é…ç½®
ssh -v your-server-ip

# 3. æµ‹è¯•æ‰‹åŠ¨è¿æ¥
ssh user@your-server-ip -p 22
```

#### 1.1. å®‰è£…æ—¶è¿œç¨‹è„šæœ¬ä¸Šä¼ å¤±è´¥
```bash
# é—®é¢˜ï¼šå®‰è£…è¿‡ç¨‹ä¸­è¿œç¨‹è„šæœ¬ä¸Šä¼ å¤±è´¥
é”™è¯¯: æ— æ³•è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
cat /mnt/d/sync.yaml

# 2. æµ‹è¯•SSHè¿æ¥
ssh your-server-ip -p 22

# 3. è·³è¿‡è¿œç¨‹è„šæœ¬ä¸Šä¼ ï¼Œæ‰‹åŠ¨ä¸Šä¼ 
scp -P 22 remote-sync-helper.sh user@server:/tmp/
ssh user@server -p 22 "chmod +x /tmp/remote-sync-helper.sh"

# 4. ç»§ç»­å®‰è£…æœåŠ¡ï¼ˆè¿œç¨‹è„šæœ¬ä¼šåœ¨é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨ä¸Šä¼ ï¼‰
sudo ./sync-service.sh install
```

#### 2. æƒé™é”™è¯¯
```bash
# é—®é¢˜ï¼šPermission denied
Permission denied (publickey)

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥SSHå¯†é’¥
ls -la ~/.ssh/
ssh-add -l

# 2. è®¾ç½®æ­£ç¡®çš„å¯†é’¥æƒé™
chmod 600 ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_rsa.pub

# 3. æ·»åŠ å¯†é’¥åˆ°ssh-agent
ssh-add ~/.ssh/id_rsa
```

#### 3. é…ç½®æ–‡ä»¶é”™è¯¯
```bash
# é—®é¢˜ï¼šé…ç½®æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯
Configuration file not found: /mnt/d/sync.yaml

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /mnt/d/sync.yaml

# 2. æ£€æŸ¥YAMLæ ¼å¼
python3 -c "import yaml; yaml.safe_load(open('/mnt/d/sync.yaml'))"

# 3. åˆ›å»ºé»˜è®¤é…ç½®
cp sync.yaml.example /mnt/d/sync.yaml
```

#### 4. Gitä»“åº“é—®é¢˜
```bash
# é—®é¢˜ï¼šä¸æ˜¯Gitä»“åº“
Not a git repository

# è§£å†³æ–¹æ¡ˆï¼š
# 1. åˆå§‹åŒ–Gitä»“åº“
cd /path/to/project
git init
git add .
git commit -m "Initial commit"

# 2. æ·»åŠ è¿œç¨‹ä»“åº“ï¼ˆå¯é€‰ï¼‰
git remote add origin https://github.com/user/repo.git
```

#### 5. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# é—®é¢˜ï¼šNo space left on device
No space left on device

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h

# 2. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -f /tmp/sync_*.tar.gz
rm -f /tmp/sync_config_cache

# 3. æ¸…ç†æ—¥å¿—æ–‡ä»¶
truncate -s 0 service.log
```

#### 6. WSLç‰¹æœ‰é—®é¢˜

##### 6.1. systemdä¸å¯ç”¨
```bash
# é—®é¢˜ï¼šSystem has not been booted with systemd
System has not been booted with systemd as init system

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥WSLç‰ˆæœ¬
wsl --version

# 2. å¯ç”¨systemdæ”¯æŒ
sudo nano /etc/wsl.conf
# æ·»åŠ ï¼š
# [boot]
# systemd=true

# 3. é‡å¯WSL
# åœ¨Windows PowerShellä¸­æ‰§è¡Œï¼š
wsl --shutdown
```

##### 6.2. Windowsè·¯å¾„è®¿é—®é—®é¢˜
```bash
# é—®é¢˜ï¼šæ— æ³•è®¿é—®Windowsç›®å½•
ls: cannot access '/mnt/d/PycharmProjects': No such file or directory

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥Windowsé©±åŠ¨å™¨æ˜¯å¦æŒ‚è½½
ls -la /mnt/

# 2. æ‰‹åŠ¨æŒ‚è½½ï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo mkdir -p /mnt/d
sudo mount -t drvfs D: /mnt/d

# 3. æ£€æŸ¥è·¯å¾„æƒé™
ls -la /mnt/d/PycharmProjects/
```

##### 6.3. æ–‡ä»¶æƒé™é—®é¢˜
```bash
# é—®é¢˜ï¼šWindowsæ–‡ä»¶æƒé™å¯¼è‡´Gité—®é¢˜
warning: CRLF will be replaced by LF

# è§£å†³æ–¹æ¡ˆï¼š
# 1. é…ç½®Gitå¤„ç†è¡Œç»“æŸç¬¦
git config --global core.autocrlf input
git config --global core.safecrlf warn

# 2. æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /mnt/d/PycharmProjects/your-project/

# 3. å¦‚æœéœ€è¦ï¼Œè°ƒæ•´umask
echo "umask 022" >> ~/.bashrc
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
# ä¿®æ”¹è„šæœ¬ï¼Œä¸´æ—¶å¯ç”¨è°ƒè¯•è¾“å‡º
set -x  # åœ¨è„šæœ¬å¼€å¤´æ·»åŠ 
# æˆ–è€…
bash -x ./sync-files.sh
```

#### 2. æ£€æŸ¥ç½‘ç»œè¿æ¥
```bash
# æµ‹è¯•SSHè¿æ¥
ssh -o ConnectTimeout=5 user@host -p port "echo 'Connection OK'"

# æµ‹è¯•SCPä¼ è¾“
echo "test" > /tmp/test.txt
scp -P port /tmp/test.txt user@host:/tmp/
```

#### 3. éªŒè¯GitçŠ¶æ€
```bash
cd /path/to/project

# æ£€æŸ¥GitçŠ¶æ€
git status
git branch -a
git log --oneline -5

# æ£€æŸ¥è¿œç¨‹é…ç½®
git remote -v
git ls-remote origin
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç½‘ç»œä¼˜åŒ–
- ä½¿ç”¨SSHå¯†é’¥è€Œéå¯†ç è®¤è¯
- é…ç½®SSHè¿æ¥å¤ç”¨ï¼š
```bash
# ~/.ssh/config
Host your-server
    ControlMaster auto
    ControlPath ~/.ssh/master-%r@%h:%p
    ControlPersist 10m
```

### 2. æ–‡ä»¶è¿‡æ»¤ä¼˜åŒ–
- åˆç†é…ç½®æ’é™¤æ¨¡å¼ï¼Œå‡å°‘ä¸å¿…è¦çš„æ–‡ä»¶ä¼ è¾“
- ä½¿ç”¨`.gitignore`æ–‡ä»¶ç®¡ç†Gitå¿½ç•¥é¡¹
- å®šæœŸæ¸…ç†å¤§æ–‡ä»¶å’Œä¸´æ—¶æ–‡ä»¶

### 3. åŒæ­¥é—´éš”è°ƒæ•´
```yaml
# å¼€å‘ç¯å¢ƒï¼šæ›´é¢‘ç¹çš„åŒæ­¥
refresh_interval: 30

# ç”Ÿäº§ç¯å¢ƒï¼šè¾ƒé•¿çš„åŒæ­¥é—´éš”
refresh_interval: 300
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### 1. SSHå®‰å…¨é…ç½®
```bash
# ç”Ÿæˆä¸“ç”¨SSHå¯†é’¥
ssh-keygen -t ed25519 -f ~/.ssh/sync_key -C "sync-service"

# é…ç½®SSHå®¢æˆ·ç«¯
# ~/.ssh/config
Host sync-server
    HostName your-server-ip
    Port 22
    User your-username
    IdentityFile ~/.ssh/sync_key
    IdentitiesOnly yes
```

### 2. æ–‡ä»¶æƒé™è®¾ç½®
```bash
# è®¾ç½®è„šæœ¬æƒé™
chmod 755 *.sh

# ä¿æŠ¤é…ç½®æ–‡ä»¶
chmod 600 /mnt/d/sync.yaml

# ä¿æŠ¤SSHå¯†é’¥
chmod 600 ~/.ssh/sync_key
chmod 644 ~/.ssh/sync_key.pub
```

### 3. é˜²ç«å¢™é…ç½®
```bash
# æœåŠ¡å™¨ç«¯ï¼šåªå…è®¸å¿…è¦çš„SSHè¿æ¥
sudo ufw allow from your-client-ip to any port 22
sudo ufw enable
```

## ğŸ“ ç»´æŠ¤ä»»åŠ¡

### å®šæœŸç»´æŠ¤æ¸…å•
- [ ] æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œå¿…è¦æ—¶è½®è½¬
- [ ] éªŒè¯SSHå¯†é’¥æœ‰æ•ˆæ€§
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- [ ] æ›´æ–°æ’é™¤æ¨¡å¼é…ç½®
- [ ] æµ‹è¯•å¤‡ä»½å’Œæ¢å¤æµç¨‹

### æ—¥å¿—è½®è½¬è®¾ç½®
```bash
# åˆ›å»ºlogrotateé…ç½®
sudo tee /etc/logrotate.d/sync-service << EOF
/path/to/service.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
}
EOF
```

## ğŸ†˜ ç´§æ€¥æƒ…å†µå¤„ç†

### æœåŠ¡æ— å“åº”
```bash
# 1. å¼ºåˆ¶åœæ­¢æœåŠ¡
sudo systemctl kill file-sync-service

# 2. æ£€æŸ¥è¿›ç¨‹
ps aux | grep sync-files

# 3. æ‰‹åŠ¨æ¸…ç†
pkill -f sync-files.sh

# 4. é‡å¯æœåŠ¡
sudo systemctl restart file-sync-service
```

### æ•°æ®æ¢å¤
```bash
# 1. ä»è¿œç¨‹æœåŠ¡å™¨æ¢å¤
rsync -avz user@host:/remote/path/ /local/path/

# 2. ä»Gitå†å²æ¢å¤
git reflog
git reset --hard commit-hash

# 3. ä»å¤‡ä»½æ¢å¤ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
tar -xzf backup.tar.gz -C /recovery/path/
```

è¿™ä¸ªå¿«é€Ÿå‚è€ƒæ‰‹å†Œæä¾›äº†æ—¥å¸¸ä½¿ç”¨å’Œæ•…éšœæ’é™¤çš„å®Œæ•´æŒ‡å—ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾å’Œè§£å†³é—®é¢˜ã€‚ 